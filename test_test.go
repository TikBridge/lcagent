// Copyright 2021 TikBridge
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package main

import (
	"context"
	"encoding/hex"
	"math/big"
	"testing"

	"github.com/ThinkiumGroup/go-common"
	"github.com/ThinkiumGroup/go-tkmrpc/models"
)

const (
	test_abi_string_1 = `[
	{
		"inputs": [
			{
				"components": [
					{
						"internalType": "bytes32",
						"name": "Hash",
						"type": "bytes32"
					},
					{
						"internalType": "bool",
						"name": "Pos",
						"type": "bool"
					},
					{
						"internalType": "uint8",
						"name": "Repeat",
						"type": "uint8"
					}
				],
				"internalType": "struct Mpts.MerkleProof[]",
				"name": "mps",
				"type": "tuple[]"
			},
			{
				"internalType": "uint32",
				"name": "index",
				"type": "uint32"
			}
		],
		"name": "HashAtIndex",
		"outputs": [
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	}
]`

	test_abi_string_2 = `[
	{
		"inputs": [
			{
				"components": [
					{
						"internalType": "bytes",
						"name": "PostState",
						"type": "bytes"
					},
					{
						"internalType": "uint64",
						"name": "Status",
						"type": "uint64"
					},
					{
						"internalType": "uint64",
						"name": "CumulativeGasUsed",
						"type": "uint64"
					},
					{
						"components": [
							{
								"internalType": "address",
								"name": "Address",
								"type": "address"
							},
							{
								"internalType": "bytes32[]",
								"name": "Topics",
								"type": "bytes32[]"
							},
							{
								"internalType": "bytes",
								"name": "Data",
								"type": "bytes"
							},
							{
								"internalType": "uint64",
								"name": "BlockNumber",
								"type": "uint64"
							},
							{
								"internalType": "bytes32",
								"name": "TxHash",
								"type": "bytes32"
							},
							{
								"internalType": "uint32",
								"name": "TxIndex",
								"type": "uint32"
							},
							{
								"internalType": "uint32",
								"name": "Index",
								"type": "uint32"
							},
							{
								"internalType": "bytes32",
								"name": "BlockHash",
								"type": "bytes32"
							}
						],
						"internalType": "struct rlptest.Log[]",
						"name": "Logs",
						"type": "tuple[]"
					},
					{
						"internalType": "bytes",
						"name": "TxHash",
						"type": "bytes"
					},
					{
						"internalType": "address",
						"name": "ContractAddress",
						"type": "address"
					},
					{
						"internalType": "uint64",
						"name": "GasUsed",
						"type": "uint64"
					},
					{
						"internalType": "bytes",
						"name": "Out",
						"type": "bytes"
					},
					{
						"internalType": "string",
						"name": "Error",
						"type": "string"
					},
					{
						"components": [
							{
								"internalType": "address",
								"name": "Winner",
								"type": "address"
							},
							{
								"internalType": "uint256",
								"name": "Val",
								"type": "uint256"
							}
						],
						"internalType": "struct rlptest.Bonus[]",
						"name": "GasBonuses",
						"type": "tuple[]"
					},
					{
						"internalType": "uint16",
						"name": "Version",
						"type": "uint16"
					}
				],
				"internalType": "struct rlptest.Receipt",
				"name": "r",
				"type": "tuple"
			}
		],
		"name": "hashReceipt",
		"outputs": [
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	}
]`
)

func _getSomeProofs(t *testing.T) []MerkleProof {
	bs, _ := hex.DecodeString("16dc5270000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000014a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000f60000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000032af0000000000000000000000000000000000000000000000000000000000001280000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000161ec000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000161ec00000000000000000000000000000000000000000000000000000000000000e200000000000000000000000000000000000000000000000000000000000000e400000000000000000000000000000000000000000000000000000000000000e60000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000287b22666565223a22353739383635363030303030303030303030222c22726f6f74223a6e756c6c7d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000006e00000000000000000000000000000000000000000000000000000000000000a40000000000000000000000000636732ebf90b2edfe868a74da9c138566797a9680000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000032af5981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f6f76b5bd09082235c9da4853776c624699ac1dd000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000003635c9adc5dea00000000000000000000000000000f6f76b5bd09082235c9da4853776c624699ac1dd0000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000032af5981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003e23247b10e5cf2e2a6a13352598fae25c889731f3b5eff5fb52184e121b41d54000000000000000000000000000000000000000000000000000000000000ea61000000000000000000000000000000000000000000000000000000000000ea630000000000000000000000000000000000000000000000000000000000000120780e8bca9a5842741c4a64d8afe3d3365c4fa59c8f399504f92a020c5d2886b7000000000000000000000000636732ebf90b2edfe868a74da9c138566797a96800000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000003635c9adc5dea0000000000000000000000000000000000000000000000000000000000000000000147886d5fdf034cdb4a6be13c7c567a7a97ca1d50200000000000000000000000000000000000000000000000000000000000000000000000000000000000000147886d5fdf034cdb4a6be13c7c567a7a97ca1d502000000000000000000000000000000000000000000000000636732ebf90b2edfe868a74da9c138566797a9680000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000032af5981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef000000000000000000000000f6f76b5bd09082235c9da4853776c624699ac1dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000003635c9adc5dea00000000000000000000000000000f6f76b5bd09082235c9da4853776c624699ac1dd0000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000032af5981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee21000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000344ff77018688dad4b245e8ab97358ed57ed92269952ece7ffd321366ce078622000000000000000000000000000000000000000000000000000000000000ea61000000000000000000000000000000000000000000000000000000000000ea6300000000000000000000000000000000000000000000000000000000000001c0780e8bca9a5842741c4a64d8afe3d3365c4fa59c8f399504f92a020c5d2886b700000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000003635c9adc5dea0000000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000014ec9aea1bd86c04d8ed55e18b9ed7adc0eae0509500000000000000000000000000000000000000000000000000000000000000000000000000000000000000147886d5fdf034cdb4a6be13c7c567a7a97ca1d50200000000000000000000000000000000000000000000000000000000000000000000000000000000000000147886d5fdf034cdb4a6be13c7c567a7a97ca1d50200000000000000000000000000000000000000000000000000000000000000000000000000000000000000140833f2bc30f00a8d6b0e5212cacc583e251ee8c9000000000000000000000000000000000000000000000000f6f76b5bd09082235c9da4853776c624699ac1dd000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000032af5981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee2100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000048c991a6f7ef9e9e8c0cc7f34d5ce0b20ff23538ec4d944e9d065b833982fc783000000000000000000000000000000000000000000000000000000000000ea61000000000000000000000000000000000000000000000000000000000000ea620000000000000000000000007857fe4267199c0766a7da1e1ab66ba01a421a64000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000205981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000007886d5fdf034cdb4a6be13c7c567a7a97ca1d50200000000000000000000000000000000000000000000000002650449d17da7560000000000000000000000000000000000000000000000000000000000000008c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a47000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000093d66d51e13422063524af9631d827a548c230669bfc9fe2aa8d6889534066000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000086b8e20c4f3cbea648983bad87105961cd1a251d8ba5b81dfdb28cb7aebd73000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000ee893e49dcb8be3872ad2df76aa43e60be03a6838ae0c68310f5b88dbf14633900000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000380f3e256a349b6cc8c301b882baf95792f309fafe2b3fde3c8cf6683cedd08a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000edeb980e10454ea7f55b6a48b4657b64a1cc98a0a50ef36a0128f26e294ac083000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a37fcf545f94a35795e28193586604f8457d55076de0df003f4386dc380613800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000ca17cc44033b9e7e056efc41ef89e375cfaa15b870bcf44c783b87f8fa697fb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000417c6d71ec8ae536a7f0435a2a6c16806e6c27df67748e73c89d8935b79aeb2e4552c9766b794edc6538f5a814b50ead138e1b9eeac992dc37e06d595124535ea1010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000414a04af6c992bcaf4e768fc726c13cf6b34fb675f37cdbcd38bdbd49fb4e4f93f5ffe7c35b0a6d575abaed9b804491523610ccb98595db6ea61cc037a8ebc2cf900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041d03a356e80cdff382d2577e229c8610aac378cd508fa447c9d3dc5d47211ec135d775a474aae493df876de62a3bca9216ae253ca0c0db90359bab926cb92f5d40000000000000000000000000000000000000000000000000000000000000000")
	obj1 := new(struct {
		Data []byte `abi:"proofBytes"`
	})
	if err := XLightNodeAbi.UnpackInput(obj1, xVerifyReceiptData, bs[4:]); err != nil {
		t.Fatal(err)
	}
	obj2 := new(struct {
		Data TKMReceiptData `abi:"receiptData"`
	})
	if err := XLightNodeAbi.UnpackInput(obj2, xVerifyReceiptStruct, obj1.Data); err != nil {
		t.Fatal(err)
	}
	return obj2.Data.Proofs
}

func TestHashAtIndex(t *testing.T) {
	ab := mustInitAbi("test abi", test_abi_string_1)
	mname := "HashAtIndex"
	obj := new(struct {
		Mps   []MerkleProof `abi:"mps"`
		Index uint32        `abi:"index"`
	})
	obj.Mps = _getSomeProofs(t)
	obj.Index = 6

	target, err := NewEthClient(context.Background(), "http://127.0.0.1:32034", nil, 10)
	if err != nil {
		t.Fatal(err)
	}
	defer target.Close()
	sender, _ := models.NewIdentifierByHex("9fa39e6c8c4a9a6d21de1c2df19f0034f10532f6ffb065407ce3eb3e3d795cd0")
	to := common.HexToAddress("0x749081E80d9FF2368593e4cb2A9B934c8f14Ee06")

	outobj := new(struct{ Value common.Hash })
	err = target.getter(context.Background(), sender.Address(), &to, ab.Methods[mname], outobj, obj.Mps, obj.Index)
	if err != nil {
		t.Fatal(err)
	}
	t.Logf("%x", outobj.Value[:])
}

func Test_ReceiptInput(t *testing.T) {
	bs, _ := hex.DecodeString("16dc5270000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000014a0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000f60000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000032af0000000000000000000000000000000000000000000000000000000000001280000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000161ec000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000161ec00000000000000000000000000000000000000000000000000000000000000e200000000000000000000000000000000000000000000000000000000000000e400000000000000000000000000000000000000000000000000000000000000e60000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000287b22666565223a22353739383635363030303030303030303030222c22726f6f74223a6e756c6c7d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000006e00000000000000000000000000000000000000000000000000000000000000a40000000000000000000000000636732ebf90b2edfe868a74da9c138566797a9680000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000032af5981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f6f76b5bd09082235c9da4853776c624699ac1dd000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000003635c9adc5dea00000000000000000000000000000f6f76b5bd09082235c9da4853776c624699ac1dd0000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000032af5981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003e23247b10e5cf2e2a6a13352598fae25c889731f3b5eff5fb52184e121b41d54000000000000000000000000000000000000000000000000000000000000ea61000000000000000000000000000000000000000000000000000000000000ea630000000000000000000000000000000000000000000000000000000000000120780e8bca9a5842741c4a64d8afe3d3365c4fa59c8f399504f92a020c5d2886b7000000000000000000000000636732ebf90b2edfe868a74da9c138566797a96800000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000003635c9adc5dea0000000000000000000000000000000000000000000000000000000000000000000147886d5fdf034cdb4a6be13c7c567a7a97ca1d50200000000000000000000000000000000000000000000000000000000000000000000000000000000000000147886d5fdf034cdb4a6be13c7c567a7a97ca1d502000000000000000000000000000000000000000000000000636732ebf90b2edfe868a74da9c138566797a9680000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000032af5981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef000000000000000000000000f6f76b5bd09082235c9da4853776c624699ac1dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000003635c9adc5dea00000000000000000000000000000f6f76b5bd09082235c9da4853776c624699ac1dd0000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000032af5981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee21000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000344ff77018688dad4b245e8ab97358ed57ed92269952ece7ffd321366ce078622000000000000000000000000000000000000000000000000000000000000ea61000000000000000000000000000000000000000000000000000000000000ea6300000000000000000000000000000000000000000000000000000000000001c0780e8bca9a5842741c4a64d8afe3d3365c4fa59c8f399504f92a020c5d2886b700000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000003635c9adc5dea0000000000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000014ec9aea1bd86c04d8ed55e18b9ed7adc0eae0509500000000000000000000000000000000000000000000000000000000000000000000000000000000000000147886d5fdf034cdb4a6be13c7c567a7a97ca1d50200000000000000000000000000000000000000000000000000000000000000000000000000000000000000147886d5fdf034cdb4a6be13c7c567a7a97ca1d50200000000000000000000000000000000000000000000000000000000000000000000000000000000000000140833f2bc30f00a8d6b0e5212cacc583e251ee8c9000000000000000000000000000000000000000000000000f6f76b5bd09082235c9da4853776c624699ac1dd000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000032af5981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee2100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000048c991a6f7ef9e9e8c0cc7f34d5ce0b20ff23538ec4d944e9d065b833982fc783000000000000000000000000000000000000000000000000000000000000ea61000000000000000000000000000000000000000000000000000000000000ea620000000000000000000000007857fe4267199c0766a7da1e1ab66ba01a421a64000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000205981b93c3a4d94da57b798916e4daa1e9bdcacbccdbc6de5d2c4b62c96d1ee210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000007886d5fdf034cdb4a6be13c7c567a7a97ca1d50200000000000000000000000000000000000000000000000002650449d17da7560000000000000000000000000000000000000000000000000000000000000008c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a47000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000093d66d51e13422063524af9631d827a548c230669bfc9fe2aa8d6889534066000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000086b8e20c4f3cbea648983bad87105961cd1a251d8ba5b81dfdb28cb7aebd73000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000ee893e49dcb8be3872ad2df76aa43e60be03a6838ae0c68310f5b88dbf14633900000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000380f3e256a349b6cc8c301b882baf95792f309fafe2b3fde3c8cf6683cedd08a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000edeb980e10454ea7f55b6a48b4657b64a1cc98a0a50ef36a0128f26e294ac083000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a37fcf545f94a35795e28193586604f8457d55076de0df003f4386dc380613800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000ca17cc44033b9e7e056efc41ef89e375cfaa15b870bcf44c783b87f8fa697fb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000417c6d71ec8ae536a7f0435a2a6c16806e6c27df67748e73c89d8935b79aeb2e4552c9766b794edc6538f5a814b50ead138e1b9eeac992dc37e06d595124535ea1010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000414a04af6c992bcaf4e768fc726c13cf6b34fb675f37cdbcd38bdbd49fb4e4f93f5ffe7c35b0a6d575abaed9b804491523610ccb98595db6ea61cc037a8ebc2cf900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041d03a356e80cdff382d2577e229c8610aac378cd508fa447c9d3dc5d47211ec135d775a474aae493df876de62a3bca9216ae253ca0c0db90359bab926cb92f5d40000000000000000000000000000000000000000000000000000000000000000")
	obj1 := new(struct {
		Data []byte `abi:"proofBytes"`
	})
	if err := XLightNodeAbi.UnpackInput(obj1, xVerifyReceiptData, bs[4:]); err != nil {
		t.Fatal(err)
	}
	obj2 := new(struct {
		Data TKMReceiptData `abi:"receiptData"`
	})
	if err := XLightNodeAbi.UnpackInput(obj2, xVerifyReceiptStruct, obj1.Data); err != nil {
		t.Fatal(err)
	}

	obj2.Data.Receipt.Logs = obj2.Data.Receipt.Logs[3:4]

	ab := mustInitAbi("test abi2", test_abi_string_2)
	mname := "hashReceipt"

	// input, err := ab.Methods[mname].Inputs.Pack(obj2.Data.Receipt)

	input, err := ab.Pack(mname, obj2.Data.Receipt)
	if err != nil {
		t.Fatal(err)
	}
	t.Logf("%x", input)
	//
	// receiptObj := new(struct{ Receipt TKMReceipt })
	// if err := ab.UnpackInput(receiptObj, mname, input[4:]); err != nil {
	// 	t.Fatal(err)
	// }
	// t.Logf("%+v", receiptObj)
}

func Test_Uint256(t *testing.T) {
	i := new(big.Int)
	bs, _ := hex.DecodeString("ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff")
	i.SetBytes(bs)
	t.Logf("%s", i)
}
