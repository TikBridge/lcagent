// Copyright 2021 TikBridge
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package main

import (
	"encoding/hex"
	"testing"
)

func TestMain(m *testing.M) {
	initTKMLNAbi()
	initUpdatableLNAbi()
	initMCSAbis()
	initRelayLNAbi()
	m.Run()
}

func TestLNABI(t *testing.T) {
	t.Log(LightNodeABI.Constructor)
	t.Log("events")
	for n, e := range LightNodeABI.Events {
		t.Log(n, "=>", e)
	}
	t.Log("methods")
	for n, e := range LightNodeABI.Methods {
		t.Log(n, "=>", e)
	}
	t.Log("errors")
	for n, e := range LightNodeABI.Errors {
		t.Log(n, "=>", e)
	}
	t.Log(LightNodeABI.Fallback)
	t.Log(LightNodeABI.Receive)
}

func TestUpdateComm(t *testing.T) {
	bs, _ := hex.DecodeString("7dd9e42f000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000011e0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000ae00000000000000000000000000000000000000000000000000000000000000e8000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000000000000000000000000000000000000000000520000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000074f40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005600000000000000000000000007857fe4267199c0766a7da1e1ab66ba01a421a64000000000000000000000000000000000000000000000000000000000000058000000000000000000000000000000000000000000000000000000000000005c000000000000000000000000000000000000000000000000000000000000005e00000000000000000000000000000000000000000000000000000000000000620000000000000000000000000000000000000000000000000000000000000066000000000000000000000000000000000000000000000000000000000000006a000000000000000000000000000000000000000000000000000000000000006e000000000000000000000000000000000000000000000000000000000000007200000000000000000000000000000000000000000000000000000000000000760000000000000000000000000000000000000000000000000000000000000078000000000000000000000000000000000000000000000000000000000000007a000000000000000000000000000000000000000000000000000000000000007c0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000008400000000000000000000000000000000000000000000000000000000000000860000000000000000000000000000000000000000000000000000000000000088000000000000000000000000000000000000000000000000000000000000008a000000000000000000000000000000000000000000000000000000000000008c000000000000000000000000000000000000000000000000000000000000008e00000000000000000000000000000000000000000000000000000000064a5526800000000000000000000000000000000000000000000000000000000000009200000000000000000000000000000000000000000000000000000000000000960000000000000000000000000000000000000000000000000000000000000098000000000000000000000000000000000000000000000000000000000000009a0000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000009c00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000a200000000000000000000000000000000000000000000000000000000000000a4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a600000000000000000000000000000000000000000000000000000000000000020fbf08aa590481ec0d66f30c2cb83899bebb9efa7a645cb8b04620baf2da9872d0000000000000000000000000000000000000000000000000000000000000020ad75a5f7b1144f250084f37dda978cded59aeaf27bd812a75186b2dbfd50c50d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020c09ce074f9fabce0b8bece6f4a46ca3cf123a6efd8b7850d071ab43225e1be7f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000203b3e5859ebb593316f59bca0e2e56d6f5e232b6c51e5b185c492cba3f3fd298d00000000000000000000000000000000000000000000000000000000000000203b3e5859ebb593316f59bca0e2e56d6f5e232b6c51e5b185c492cba3f3fd298d0000000000000000000000000000000000000000000000000000000000000014778fd7925788c8eb44210eba62fd241cc48f64210000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000001d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000201944bb47b81d43c1baf7153ff693ddfe6df99dd1eaf30c0cffbb0783724ab2f300000000000000000000000000000000000000000000000000000000000000201944bb47b81d43c1baf7153ff693ddfe6df99dd1eaf30c0cffbb0783724ab2f30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020acf1890a60e805815cbf6e93fdb9f7a0184bc51290a39802e0c67e961ab41f3500000000000000000000000000000000000000000000000000000000000000201f17d0958c00f27cc875f5e0315bc912a287e4a850b9bdd2bb6fc0bade721570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020ab09b91a444c23c53b82224fbe3d4e49901d409238e6f6560419061984d1f20000000000000000000000000000000000000000000000000000000000000000205fafba1dce5decf45db4c2e60da7169cc286f123a5f06408afa6e12169b64fe60000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020feaaf7c7d250f4aa3830b98a21a8d74ecc71f8792118fbb4cea6f15f899f3eb40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000026000000000000000000000000000000000000000000000000000000000000002c0000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000000403833762f08a014e8effe7291ec32bca9448b7fb6566283827173d40bd5a66f58c7e57c897c2fb473ce77b25059e01e7e432a268096eed0c2bfec37839b33a601000000000000000000000000000000000000000000000000000000000000004079d260d785858034d64641b9a5867bd08e3f6cae9a3f18e09dfd1a238808b97093d74a8f1a15d9cbab68b005383a2637cce73110f3dfb5faea0a7c371f0976b900000000000000000000000000000000000000000000000000000000000000408d3e9e02ba9f95e47815891aeb9241e4a9958fcddc0e4b02e01fb167f93f5b935806b452ed3d616c0f04bd1c3934c943a7458feec28d9064c5f72b16a8307a5b0000000000000000000000000000000000000000000000000000000000000040a93b150f11c422d8700554859281be8e34a91a859e0e021af186002c7e4a2661ea2467a63b417030d68e2fdddeb4342943dff13225da77124abf912fd092f71f0000000000000000000000000000000000000000000000000000000000000040d53eddbbb20a4bdd4d2ca39af0a9b7b90abdba10180c69096fa7d10e0b7ce79a413a53dae1a6686e72f00b10e0645b1819bf8063f32292b3a6eac1ba2d111cc80000000000000000000000000000000000000000000000000000000000000040d85507831cf69ffd61d7c58b1a1954178642dfcfdf3d725f78dc7c676772b896590a88acdff9abf2883b55bbaa3d8e198c4121723817b48c2cce0d4f73f186af0000000000000000000000000000000000000000000000000000000000000040db3e5b5ea24e1d760a59cf22cfafeed5a4e57af2108fc0df3bf457a82f754264b3fdf9d77fcab306a9809ebcd76de91e382d912a90e3f37edf4eb04f3f036d0b000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002a000000000000000000000000000000000000000000000000000000000000000411427478ef35be3bffa460a86d2df5574193090f4f211919f22c799e0cb4a1b9359b518cce0b7a5a9b1cff057c77840b25c8818d45add0fc04890e847f1a1e05b010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000417a9a7c05140fdf3cbee9057fafe33b969c736bd016dcc99ca66f23bf95ff7c34268394bb493398a222d6184e08c9c12ab679f0ce7828ddda32156b35e1826b9901000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041203bebb08ab2059d4a1959947be830adac35be1f2ba41b93eb1ed618028f1b0f35923d52b8efcac93d09448360a56a5f2f40e5d45614f9022be8f779162154d3010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000414720dc129e3a30b84df862fe9b39da5634bcf8b558b1a69c0e3381170c4f756d361ead6b5cf6b96c8b4f76d66cc96cfad3024ed9cd1fd0d0d4bd0ac4c36fd489010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000411788629986532fc1c1605e491f6268a477a8932135ed5d07f83fe095728456a720316ea74c3c54b0fe4a7fb0adb8e4cb4e8ed1febfd180a7d4d8b94f05a9f3520100000000000000000000000000000000000000000000000000000000000000")
	a := new(struct {
		Bs []byte `abi:"_epochCommittee"`
	})
	if err := LightNodeABI.UnpackInput(a, updateCommName, bs[4:]); err != nil {
		t.Fatal(err)
	}
	t.Logf("%x", a.Bs)
	b := new(struct {
		Proof TKMCommProof `abi:"epochCommittee"`
	})
	if err := LightNodeABI.UnpackInput(b, updateNextCommName, a.Bs); err != nil {
		t.Fatal(err)
	}
	t.Log(b.Proof)
}
